include:
  - ../../../docker-compose.yml

services:
  deploy:
    image: curlimages/curl:latest
    depends_on:
      zenbpm:
        condition: service_healthy
    volumes:
      - .:/process:ro
    command: ["-sfS", "-X", "POST", "http://zenbpm:8080/v1/process-definitions", "-F", "resource=@/process/commission-payout.bpmn"]

  log-worker:
    build: ../../workers/log-worker
    environment:
      ZENBPM_GRPC_ADDR: zenbpm:9090
    depends_on:
      zenbpm:
        condition: service_healthy

  openai-connector:
    build: ../../workers/openai-connector
    environment:
      ZENBPM_GRPC_ADDR: zenbpm:9090
      OPENAI_API_KEY: ${OPENAI_API_KEY:?Set OPENAI_API_KEY in .env or environment}
    depends_on:
      zenbpm:
        condition: service_healthy
